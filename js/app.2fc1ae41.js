(function(){"use strict";var e={6628:function(e,t,s){var a=s(3751),i=s(641);function l(e,t,s,a,l,r){const o=(0,i.g2)("router-view"),n=(0,i.g2)("GlobalAudioPlayer");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(o),l.player?((0,i.uX)(),(0,i.Wv)(n,{key:0,src:l.player.url,title:l.player.song,artist:l.player.singer,cover:l.player.cover,musicId:l.player.id,onEnded:r.playNext,onTimeupdate:r.handleTimeUpdate,onPrev:r.playPrev,onNext:r.playNext},null,8,["src","title","artist","cover","musicId","onEnded","onTimeupdate","onPrev","onNext"])):(0,i.Q3)("",!0)],64)}var r=s(33);const o={class:"global-audio-player"},n=["src"],c={class:"player-meta"},u={class:"player-title"},d={class:"player-artist"},h={class:"player-controls"},v=["disabled"],y=["disabled"],p={key:0,viewBox:"0 0 24 24",class:"icon"},m={key:1,viewBox:"0 0 24 24",class:"icon"},f=["disabled"],g={class:"progress-container"},k={class:"time-display"},L={class:"progress-bar"},b={class:"time-display"},I={class:"volume-control"},C={key:0,viewBox:"0 0 24 24",class:"icon icon-small"},w={key:1,viewBox:"0 0 24 24",class:"icon icon-small"},$={key:2,viewBox:"0 0 24 24",class:"icon icon-small"},S={class:"volume-slider-wrapper"},_=["src"];function M(e,t,s,l,M,P){return(0,i.bo)(((0,i.uX)(),(0,i.CE)("div",o,[(0,i.Lk)("div",{class:(0,r.C4)(["player-info",{clickable:s.musicId}]),onClick:t[0]||(t[0]=(...e)=>P.navigateToDetail&&P.navigateToDetail(...e))},[s.cover?((0,i.uX)(),(0,i.CE)("img",{key:0,src:s.cover,class:"player-cover"},null,8,n)):(0,i.Q3)("",!0),(0,i.Lk)("div",c,[(0,i.Lk)("div",u,(0,r.v_)(s.title||"未选择歌曲"),1),(0,i.Lk)("div",d,(0,r.v_)(s.artist),1)])],2),(0,i.Lk)("div",h,[(0,i.Lk)("button",{class:"control-btn small-btn",onClick:t[1]||(t[1]=t=>e.$emit("prev")),disabled:!s.src},[...t[14]||(t[14]=[(0,i.Lk)("svg",{viewBox:"0 0 24 24",class:"icon"},[(0,i.Lk)("path",{d:"M6 12l10-7v14L6 12zm-2 7h2V5H4v14z",fill:"currentColor"})],-1)])],8,v),(0,i.Lk)("button",{class:"control-btn play-pause-btn",onClick:t[2]||(t[2]=(...e)=>P.togglePlay&&P.togglePlay(...e)),disabled:!s.src},[M.isPlaying?((0,i.uX)(),(0,i.CE)("svg",m,[...t[16]||(t[16]=[(0,i.Lk)("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z",fill:"currentColor"},null,-1)])])):((0,i.uX)(),(0,i.CE)("svg",p,[...t[15]||(t[15]=[(0,i.Lk)("path",{d:"M8 5v14l11-7z",fill:"currentColor"},null,-1)])]))],8,y),(0,i.Lk)("button",{class:"control-btn small-btn",onClick:t[3]||(t[3]=t=>e.$emit("next")),disabled:!s.src},[...t[17]||(t[17]=[(0,i.Lk)("svg",{viewBox:"0 0 24 24",class:"icon"},[(0,i.Lk)("path",{d:"M18 12L8 19V5l10 7zm2-7h-2v14h2V5z",fill:"currentColor"})],-1)])],8,f),(0,i.Lk)("div",g,[(0,i.Lk)("div",k,(0,r.v_)(P.formatTime(M.currentTime)),1),(0,i.Lk)("div",{class:"progress-bar-wrapper",onClick:t[4]||(t[4]=(...e)=>P.seek&&P.seek(...e))},[(0,i.Lk)("div",L,[(0,i.Lk)("div",{class:"progress-bar-fill",style:(0,r.Tr)({width:P.progress+"%"})},[...t[18]||(t[18]=[(0,i.Lk)("div",{class:"progress-handle"},null,-1)])],4)])]),(0,i.Lk)("div",b,(0,r.v_)(P.formatTime(M.duration)),1)]),(0,i.Lk)("div",I,[(0,i.Lk)("button",{class:"control-btn volume-btn",onClick:t[5]||(t[5]=(...e)=>P.toggleMute&&P.toggleMute(...e))},[M.volume>.5?((0,i.uX)(),(0,i.CE)("svg",C,[...t[19]||(t[19]=[(0,i.Lk)("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z",fill:"currentColor"},null,-1)])])):M.volume>0?((0,i.uX)(),(0,i.CE)("svg",w,[...t[20]||(t[20]=[(0,i.Lk)("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z",fill:"currentColor"},null,-1)])])):((0,i.uX)(),(0,i.CE)("svg",$,[...t[21]||(t[21]=[(0,i.Lk)("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z",fill:"currentColor"},null,-1)])]))]),(0,i.Lk)("div",S,[(0,i.bo)((0,i.Lk)("input",{type:"range",class:"volume-slider",min:"0",max:"100","onUpdate:modelValue":t[6]||(t[6]=e=>M.volumePercent=e),onInput:t[7]||(t[7]=(...e)=>P.changeVolume&&P.changeVolume(...e))},null,544),[[a.Jo,M.volumePercent]])])])]),(0,i.Lk)("audio",{autoplay:"",ref:"audio",src:s.src,onEnded:t[8]||(t[8]=(...e)=>P.onEnded&&P.onEnded(...e)),onPlay:t[9]||(t[9]=(...e)=>P.onPlay&&P.onPlay(...e)),onPause:t[10]||(t[10]=(...e)=>P.onPause&&P.onPause(...e)),onTimeupdate:t[11]||(t[11]=(...e)=>P.updateTime&&P.updateTime(...e)),onLoadedmetadata:t[12]||(t[12]=(...e)=>P.updateDuration&&P.updateDuration(...e))},null,40,_),(0,i.Lk)("button",{class:"player-close",onClick:t[13]||(t[13]=(...e)=>P.closePlayer&&P.closePlayer(...e))},"✖")],512)),[[a.aG,M.visible]])}s(4114);var P={name:"GlobalAudioPlayer",props:{src:String,title:String,artist:String,cover:String,musicId:[String,Number]},data(){return{visible:!0,isPlaying:!1,currentTime:0,duration:0,volume:1,volumePercent:100,lastVolume:1}},computed:{progress(){return this.duration?this.currentTime/this.duration*100:0}},watch:{src(e){this.visible=!!e,e&&this.$nextTick(()=>{this.$refs.audio&&this.$refs.audio.play()})}},methods:{togglePlay(){const e=this.$refs.audio;e&&(this.isPlaying?e.pause():e.play())},onEnded(){this.isPlaying=!1,this.$emit("ended")},onPlay(){this.isPlaying=!0,this.$emit("play")},onPause(){this.isPlaying=!1,this.$emit("pause")},updateTime(){const e=this.$refs.audio;e&&(this.currentTime=e.currentTime,this.$emit("timeupdate",this.currentTime))},updateDuration(){const e=this.$refs.audio;e&&(this.duration=e.duration)},seek(e){const t=this.$refs.audio;if(!t||!this.duration)return;const s=e.currentTarget.getBoundingClientRect(),a=e.clientX-s.left,i=a/s.width;t.currentTime=i*this.duration},changeVolume(){const e=this.$refs.audio;e&&(this.volume=this.volumePercent/100,e.volume=this.volume)},toggleMute(){const e=this.$refs.audio;e&&(this.volume>0?(this.lastVolume=this.volume,this.volume=0,this.volumePercent=0,e.volume=0):(this.volume=this.lastVolume,this.volumePercent=100*this.lastVolume,e.volume=this.lastVolume))},formatTime(e){if(!e||isNaN(e))return"0:00";const t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s.toString().padStart(2,"0")}`},navigateToDetail(){this.musicId&&this.$router.push(`/music/${this.musicId}`)},closePlayer(){this.visible=!1;const e=this.$refs.audio;e&&e.pause()}},mounted(){const e=this.$refs.audio;e&&(e.volume=this.volume)}},T=s(6262);const B=(0,T.A)(P,[["render",M],["__scopeId","data-v-487dd438"]]);var E=B,X=s(7571),x={name:"App",components:{GlobalAudioPlayer:E},data(){return{player:{url:"",song:"",singer:"",cover:"",album:"",quality:"",size:"",interval:"",kbps:"",id:"",playIndex:0,playList:[],currentTime:0}}},methods:{handleTimeUpdate(e){this.player&&(this.player.currentTime=e)},async retryFetchMusicUrl(e,t=15,s=1e3){for(let i=1;i<=t;i++){try{const t=await(0,X.searchMusicByIdVkeys)(e);if(t.data&&200===t.data.code&&t.data.data.url)return console.log(`✅ 第 ${i} 次获取成功`),t.data.data.url;console.warn(`⚠️ 第 ${i} 次获取失败，继续重试...`)}catch(a){console.error(`❌ 第 ${i} 次请求出错`,a)}await new Promise(e=>setTimeout(e,s))}return console.error(`❌ 已重试 ${t} 次仍失败，放弃`),null},async playPrev(){const e=this.$root.player;console.log("app 播放上一首");const t=e.playIndex-1;if(t>=0){const s=e.playList[t],a=await this.retryFetchMusicUrl(s.id);a?this.$root.player={...e,url:a,song:s.song,singer:s.singer,cover:s.cover,album:s.album,id:s.id,playIndex:t,playList:e.playList}:(console.log("无法获取上一首 URL，停止播放"),this.$root.player=null)}else console.log("已经是第一首了")},async playNext(){const e=this.$root.player;console.log("app 播放下一首");const t=e.playIndex+1;if(t<e.playList.length){const s=e.playList[t];console.log("准备播放下一首：",s.song);const a=await this.retryFetchMusicUrl(s.id);a?this.$root.player={...e,url:a,song:s.song,singer:s.singer,cover:s.cover,album:s.album,id:s.id,playIndex:t,playList:e.playList}:(console.log("无法获取下一首 URL，停止播放"),this.$root.player=null)}else console.log("播放完最后一首，清空播放器"),this.$root.player=null},async $searchMusicByIdVkeys(e){const{searchMusicByIdVkeys:t}=await Promise.resolve().then(s.bind(s,7571));return t(e)}}};const F=(0,T.A)(x,[["render",l]]);var O=F,V=s(5220);const D={id:"music-search"},U={class:"search-header"},z={class:"search-bar"},A=["placeholder"],N={key:0},Q={key:1,class:"error"},G={key:3},q=["src","alt"],J={class:"detail-info detail-info-fancy"},R={class:"detail-song detail-song-fancy"},H={class:"detail-meta-row"},j={class:"detail-singer"},W={class:"detail-album"},K={class:"detail-meta-row"},Y={class:"detail-time"},Z={class:"detail-quality"},ee={class:"detail-meta-row"},te={class:"detail-interval"},se={class:"detail-size"},ae={class:"detail-kbps"},ie={class:"detail-link"},le=["href"],re={key:0},oe={key:1},ne={key:4};function ce(e,t,s,l,o,n){const c=(0,i.g2)("MusicList");return(0,i.uX)(),(0,i.CE)("div",D,[(0,i.Lk)("div",U,[t[7]||(t[7]=(0,i.Lk)("h1",{class:"search-title"},"音乐搜索",-1)),(0,i.Lk)("button",{class:"fav-list-btn",onClick:t[0]||(t[0]=t=>e.$router.push("/favorite"))},"我喜欢的音乐歌单")]),(0,i.Lk)("div",z,[(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.searchType=e),class:"search-type-select"},[...t[8]||(t[8]=[(0,i.Lk)("option",{value:"word"},"歌曲名字 >",-1),(0,i.Lk)("option",{value:"id"},"ID/链接",-1)])],512),[[a.u1,o.searchType]]),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.searchInput=e),onKeyup:t[3]||(t[3]=(0,a.jR)((...e)=>n.handleSearchUnified&&n.handleSearchUnified(...e),["enter"])),placeholder:"word"===o.searchType?"请输入歌曲名或歌手":"请输入歌曲ID",class:"search-input"},null,40,A),[[a.Jo,o.searchInput]]),(0,i.Lk)("button",{class:"search-btn",onClick:t[4]||(t[4]=(...e)=>n.handleSearchUnified&&n.handleSearchUnified(...e))},"搜索")]),o.loading?((0,i.uX)(),(0,i.CE)("div",N,"搜索中...")):(0,i.Q3)("",!0),o.error?((0,i.uX)(),(0,i.CE)("div",Q,(0,r.v_)(o.error),1)):(0,i.Q3)("",!0),o.results.length?((0,i.uX)(),(0,i.Wv)(c,{key:2,list:o.results,onGoDetail:n.handleGoDetail,class:"music-list"},null,8,["list","onGoDetail"])):(0,i.Q3)("",!0),o.resultById?((0,i.uX)(),(0,i.CE)("div",G,[(0,i.Lk)("div",{class:"detail-card detail-card-fancy",onClick:t[6]||(t[6]=e=>n.handleGoDetail(o.resultById.id))},[(0,i.Lk)("img",{src:o.resultById.cover,alt:o.resultById.song,class:"detail-cover detail-cover-fancy"},null,8,q),(0,i.Lk)("div",J,[(0,i.Lk)("div",R,(0,r.v_)(o.resultById.song),1),(0,i.Lk)("div",H,[(0,i.Lk)("span",j,"歌手："+(0,r.v_)(o.resultById.singer),1),(0,i.Lk)("span",W,"专辑："+(0,r.v_)(o.resultById.album),1)]),(0,i.Lk)("div",K,[(0,i.Lk)("span",Y,"发行时间："+(0,r.v_)(o.resultById.time||"未知"),1),(0,i.Lk)("span",Z,"音质："+(0,r.v_)(o.resultById.quality),1)]),(0,i.Lk)("div",ee,[(0,i.Lk)("span",te,"时长："+(0,r.v_)(o.resultById.interval||"未知"),1),(0,i.Lk)("span",se,"大小："+(0,r.v_)(o.resultById.size||"未知"),1),(0,i.Lk)("span",ae,"码率："+(0,r.v_)(o.resultById.kbps||"未知"),1)]),(0,i.Lk)("div",ie,[(0,i.Lk)("a",{href:o.resultById.link,target:"_blank"},"网易云播放页",8,le)]),(0,i.Lk)("button",{class:(0,r.C4)(["fav-btn fancy-fav-btn",{liked:n.isFavorite(o.resultById.id)}]),onClick:t[5]||(t[5]=(0,a.D$)(e=>n.toggleFavorite(o.resultById.id),["stop"]))},[n.isFavorite(o.resultById.id)?((0,i.uX)(),(0,i.CE)("span",re,"❤️ 已收藏")):((0,i.uX)(),(0,i.CE)("span",oe,"🤍 收藏"))],2)])])])):o.loading||o.error||o.results.length||o.resultById?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",ne,"暂无结果"))])}const ue={class:"music-list"},de=["src","alt","onClick"],he=["onClick"],ve={class:"song"},ye={class:"singer"},pe={class:"album"},me={class:"time"},fe={class:"quality"},ge=["onClick"],ke={key:0},Le={key:1},be=["onClick"],Ie=["src"];function Ce(e,t,s,l,o,n){const c=(0,i.g2)("van-icon");return(0,i.uX)(),(0,i.CE)("ul",ue,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(s.list,(e,t)=>((0,i.uX)(),(0,i.CE)("li",{key:e.id,class:"music-item"},[(0,i.Lk)("img",{src:e.cover,alt:e.song,class:"cover",onClick:t=>n.goDetail(e.id),style:{cursor:"pointer"}},null,8,de),(0,i.Lk)("div",{class:"info",onClick:t=>n.goDetail(e.id),style:{cursor:"pointer",flex:"1"}},[(0,i.Lk)("div",ve,(0,r.v_)(e.song),1),(0,i.Lk)("div",ye,"歌手："+(0,r.v_)(e.singer),1),(0,i.Lk)("div",pe,"专辑："+(0,r.v_)(e.album),1),(0,i.Lk)("div",me,"发行时间："+(0,r.v_)(e.time||"未知"),1),(0,i.Lk)("div",fe,"音质："+(0,r.v_)(e.quality),1)],8,he),(0,i.Lk)("button",{class:(0,r.C4)(["fav-btn",{liked:n.isFavorite(e.id)}]),onClick:(0,a.D$)(t=>n.toggleFavorite(e.id),["stop"])},[n.isFavorite(e.id)?((0,i.uX)(),(0,i.CE)("span",ke,"❤️")):((0,i.uX)(),(0,i.CE)("span",Le,"🤍"))],10,ge),(0,i.Lk)("button",{class:"play-btn",onClick:s=>n.handlePlay(e,t)},[(0,i.bF)(c,{name:"play-circle"})],8,be),o.audioMap[e.id]?((0,i.uX)(),(0,i.CE)("audio",{key:0,src:o.audioMap[e.id],controls:"",style:{width:"120px","margin-left":"8px","vertical-align":"middle",display:"none"}},null,8,Ie)):(0,i.Q3)("",!0)]))),128))])}var we={name:"MusicList",props:{list:{type:Array,default:()=>[]}},data(){return{favoriteIds:JSON.parse(localStorage.getItem("favoriteMusicIds")||"[]"),audioMap:{}}},methods:{playGlobal(e,t,s){this.$root.player={url:s,song:e.name||e.song,singer:e.singer||e.ar_name,cover:e.cover||e.pic,album:e.album||e.al_name,quality:e.quality,size:e.size,interval:e.interval,kbps:e.kbps,id:e.id,playIndex:t,playList:this.list}},async handlePlay(e,t){console.log("播放了",t);const s=await(0,X.searchMusicByIdVkeys)(e.id);let a="";s.data&&200===s.data.code&&s.data.data.url?(a=s.data.data.url,this.audioMap[e.id]=s.data.data.url):this.audioMap[e.id]="",this.playGlobal(e,t,a)},goDetail(e){this.$root.player={...this.$root.player,playList:this.list},this.$emit("go-detail",e)},isFavorite(e){return this.favoriteIds.includes(e)},toggleFavorite(e){const t=this.favoriteIds.indexOf(e);t>-1?this.favoriteIds.splice(t,1):this.favoriteIds.push(e),localStorage.setItem("favoriteMusicIds",JSON.stringify(this.favoriteIds)),this.$emit("favorite-change",this.favoriteIds)}}};const $e=(0,T.A)(we,[["render",Ce],["__scopeId","data-v-bcd872e6"]]);var Se=$e,_e={name:"MusicSearch",components:{MusicList:Se},data(){return{favoriteIds:JSON.parse(localStorage.getItem("favoriteMusicIds")||"[]"),searchType:"word",searchInput:"",results:[],resultById:null,loading:!1,error:""}},mounted(){this.isFavorite();const e=localStorage.getItem("musicSearchState");if(e)try{const t=JSON.parse(e);this.searchType=t.searchType||"word",this.searchInput=t.searchInput||"",this.results=t.results||[],this.resultById=t.resultById||null}catch(t){console.error("恢复搜索状态失败：",t)}},methods:{isFavorite(e){return this.favoriteIds.includes(e)},toggleFavorite(e){const t=this.favoriteIds.indexOf(e);t>-1?this.favoriteIds.splice(t,1):this.favoriteIds.push(e),localStorage.setItem("favoriteMusicIds",JSON.stringify(this.favoriteIds)),this.$emit("favorite-change",this.favoriteIds)},async handleSearchUnified(){if(!this.searchInput.trim())return this.error="word"===this.searchType?"请输入关键词":"请输入歌曲ID或链接",this.results=[],void(this.resultById=null);this.loading=!0,this.error="",this.results=[],this.resultById=null;try{if("word"===this.searchType){const e=await(0,X.W)(this.searchInput);e.data&&200===e.data.code?this.results=e.data.data||[]:(this.error=e.data.message||"搜索失败",this.results=[])}else{let e=this.searchInput.trim();const t=e.match(/id=(\d+)/);t&&(e=t[1]);const s=await(0,X.searchMusicByIdVkeys)(e);console.log("ID/链接搜索结果:",s),s.data&&200===s.data.code&&s.data.data?this.resultById=s.data.data:(this.error=s.data.message||"未找到该ID对应的歌曲",this.resultById=null)}}catch(e){this.error="请求失败，请稍后重试",this.results=[],this.resultById=null}finally{this.loading=!1}},handleGoDetail(e){localStorage.setItem("musicSearchState",JSON.stringify({searchType:this.searchType,searchInput:this.searchInput,results:this.results,resultById:this.resultById})),this.$router.push({path:`/music/${e}`})}}};const Me=(0,T.A)(_e,[["render",ce],["__scopeId","data-v-2e796eae"]]);var Pe=Me;const Te={key:0,class:"music-detail-flex"},Be={class:"music-detail-left"},Ee=["src","alt"],Xe={class:"music-detail-title"},xe={class:"music-detail-meta"},Fe={class:"music-detail-singer"},Oe={class:"music-detail-album"},Ve={class:"music-detail-quality"},De={class:"music-detail-size"},Ue={class:"music-detail-right"},ze={key:0,class:"lyric-block",ref:"lyricBlock"},Ae={class:"lyric-scroll"},Ne={key:1,class:"lyric-block"},Qe={class:"lyric"},Ge={class:"select-audio"},qe={class:"music-detail-select"},Je=["value"],Re={class:"music-detail-audio"},He={key:0,class:"music-detail-nourl"},je={key:1},We={key:2,class:"error"};function Ke(e,t,s,l,o,n){return o.music?((0,i.uX)(),(0,i.CE)("div",Te,[(0,i.Lk)("div",Be,[(0,i.Lk)("img",{src:o.music.cover,alt:o.music.song,class:"music-detail-cover"},null,8,Ee),(0,i.Lk)("h2",Xe,(0,r.v_)(o.music.song),1),(0,i.Lk)("div",xe,[(0,i.Lk)("div",Fe,"歌手："+(0,r.v_)(o.music.singer),1),(0,i.Lk)("div",Oe,"专辑："+(0,r.v_)(o.music.album),1),(0,i.Lk)("div",Ve,"音质："+(0,r.v_)(o.music.quality),1),(0,i.Lk)("div",De,"大小："+(0,r.v_)(o.music.size||"未知"),1)])]),(0,i.Lk)("div",Ue,[o.parsedLyric.length?((0,i.uX)(),(0,i.CE)("div",ze,[t[3]||(t[3]=(0,i.Lk)("h3",null,"歌词",-1)),(0,i.Lk)("div",Ae,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.parsedLyric,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:(0,r.C4)(["lyric-line",{active:t===o.currentLine}]),ref_for:!0,ref:t===o.currentLine?"activeLyric":null},(0,r.v_)(e.text),3))),128))])],512)):o.lyric?((0,i.uX)(),(0,i.CE)("div",Ne,[t[4]||(t[4]=(0,i.Lk)("h3",null,"歌词",-1)),(0,i.Lk)("pre",Qe,(0,r.v_)(o.lyric),1)])):(0,i.Q3)("",!0),(0,i.Lk)("div",Ge,[(0,i.Lk)("div",qe,[t[5]||(t[5]=(0,i.Lk)("label",{class:"music-detail-label"},"音质：",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.selectedQuality=e),onChange:t[1]||(t[1]=(...e)=>n.fetchAndPlay&&n.fetchAndPlay(...e)),class:"music-detail-selectbox"},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.qualityOptions,e=>((0,i.uX)(),(0,i.CE)("option",{key:e.value,value:e.value},(0,r.v_)(e.label),9,Je))),128))],544),[[a.u1,o.selectedQuality]])]),(0,i.Lk)("div",Re,[(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>n.playGlobal&&n.playGlobal(...e))},"播放"),o.audioUrl||o.loading?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",He,"请选择音质获取试听链接"))])])])])):o.loading?((0,i.uX)(),(0,i.CE)("div",je,"加载中...")):o.error?((0,i.uX)(),(0,i.CE)("div",We,(0,r.v_)(o.error),1)):(0,i.Q3)("",!0)}var Ye={name:"MusicDetail",data(){return{music:null,loading:!1,error:"",selectedQuality:4,qualityOptions:[{value:1,label:"标准（64k）"},{value:2,label:"标准（128k）"},{value:3,label:"HQ极高（192k）"},{value:4,label:"HQ极高（320k）"},{value:5,label:"SQ无损"},{value:6,label:"高解析度无损（Hi-Res）"},{value:7,label:"高清臻音（Spatial Autio）"},{value:8,label:"沉浸环绕声（Surround Autio）"},{value:9,label:"超清母带（Master）"}],audioUrl:"",lyric:"",parsedLyric:[],currentLine:0}},async created(){await this.fetchAndPlay(),await this.fetchLyric()},methods:{handleLyric(e){let t=0;for(let s=0;s<this.parsedLyric.length;s++){if(!(e>=this.parsedLyric[s].time))break;t=s}this.currentLine=t,this.scrollLyric()},async fetchAndPlay(){const e=this.$route.params.id;if(!e)return void(this.error="无效的歌曲ID");this.loading=!0,this.audioUrl="";let t=0;const s=10;while(t<s)try{const a=await(0,X.searchMusicByIdVkeys)(e,this.selectedQuality);if(a.data&&200===a.data.code){this.music=a.data.data,this.audioUrl=a.data.data.url||"",this.error="";break}if(!a.data||503!==a.data.code){this.error=a.data?.message||"未找到该音质的播放链接";break}if(t++,!(t>=s)){console.warn(`503 错误，正在重试 (${t}/${s})...`);continue}this.error="请求失败，已重试 10 次"}catch(a){this.error="请求失败，请稍后重试";break}finally{this.loading=!1}},async fetchLyric(){const e=this.$route.params.id;if(!e)return;let t=0,s=!1;while(t<5&&!s)try{const a=await(0,X.E)(e);if(a.data&&200===a.data.code)this.lyric=a.data.data.lrc||"",console.log("获取歌词:",this.lyric),this.parsedLyric=this.parseLRC(this.lyric),s=!0;else{if(!a.data||503!==a.data.code){this.lyric="暂无歌词",this.parsedLyric=[];break}t++,await new Promise(e=>setTimeout(e,500))}}catch(a){t++,t>=5&&(this.lyric="歌词获取失败",this.parsedLyric=[])}},parseLRC(e){if(!e)return[];const t=e.split(/\r?\n/),s=[],a=/\[(\d{2}):(\d{2}(?:\.\d{1,3})?)\]/g;for(const i of t){const e=[...i.matchAll(a)],t=i.replace(a,"").trim();for(const a of e){const e=parseInt(a[1]),i=parseFloat(a[2]),l=60*e+i;t&&s.push({time:l,text:t})}}return s.sort((e,t)=>e.time-t.time)},onTimeUpdate(e){const t=e.target,s=t.currentTime;let a=0;for(let i=0;i<this.parsedLyric.length;i++){if(!(s>=this.parsedLyric[i].time))break;a=i}this.currentLine=a,this.scrollLyric()},scrollLyric(){this.$nextTick(()=>{const e=this.$refs.lyricBlock,t=this.$refs.activeLyric;if(e&&t&&t[0]){const s=e,a=t[0];s.scrollTop=a.offsetTop-s.offsetHeight/2+a.offsetHeight/2}})},playGlobal(){if(this.music){const e=this.$root.player.playList||this.$route.query.playList||[],t=e.findIndex(e=>e.id===this.music.id);this.$root.player={...this.$root.player,...this.music,src:this.audioUrl,playList:e,playIndex:-1!==t?t:0}}}},watch:{selectedQuality(){this.fetchAndPlay(),this.fetchLyric()},"$root.player.currentTime"(e){this.$root.player&&this.$root.player.id===this.music?.id&&this.handleLyric(e)}}};const Ze=(0,T.A)(Ye,[["render",Ke],["__scopeId","data-v-ebce81b2"]]);var et=Ze;const tt={class:"favorite-list"},st={key:0,class:"empty"};function at(e,t,s,l,r,o){const n=(0,i.g2)("FavoriteMusicList");return(0,i.uX)(),(0,i.CE)("div",tt,[t[0]||(t[0]=(0,i.Lk)("h2",null,"我喜欢的音乐",-1)),(0,i.bF)(a.F,{name:"stagger",tag:"div"},{default:(0,i.k6)(()=>[r.favoriteSongs.length?((0,i.uX)(),(0,i.Wv)(n,{key:"fav-list",list:r.favoriteSongs,onRefresh:o.fetchFavorites},null,8,["list","onRefresh"])):(0,i.Q3)("",!0)]),_:1}),r.favoriteSongs.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",st,"暂无喜欢的音乐"))])}s(8111),s(2489),s(7588),s(1701);const it={class:"fav-music-list"},lt=["onClick"],rt=["src","alt"],ot={class:"fav-info"},nt={class:"fav-song"},ct={class:"fav-singer"},ut={class:"fav-album"},dt={class:"fav-quality"},ht={class:"fav-audio-row"},vt=["onClick"],yt=["onClick"];function pt(e,t,s,l,o,n){const c=(0,i.g2)("van-icon");return(0,i.uX)(),(0,i.CE)("ul",it,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(s.list,(e,s)=>((0,i.uX)(),(0,i.CE)("li",{key:e.url||e.id,style:(0,r.Tr)({"--i":s}),class:"fav-music-item",onClick:t=>n.handleGoDetail(e.id)},[(0,i.Lk)("img",{src:e.pic||e.cover,alt:e.name||e.song,class:"fav-cover"},null,8,rt),(0,i.Lk)("div",ot,[(0,i.Lk)("div",nt,(0,r.v_)(e.name||e.song),1),(0,i.Lk)("div",ct,"歌手："+(0,r.v_)(e.ar_name||e.singer),1),(0,i.Lk)("div",ut,"专辑："+(0,r.v_)(e.al_name||e.album),1),(0,i.Lk)("div",dt,"音质："+(0,r.v_)(e.quality),1),(0,i.Lk)("div",ht,[(0,i.Lk)("button",{class:"play-btn",onClick:(0,a.D$)(t=>n.playGlobal(e,s),["stop"])},[(0,i.bF)(c,{name:"play-circle-o"}),t[0]||(t[0]=(0,i.eW)(" 播放 ",-1))],8,vt),(0,i.Lk)("button",{class:"unfav-btn",onClick:(0,a.D$)(t=>n.removeFavorite(e.id),["stop"])},"❤️",8,yt)])])],12,lt))),128))])}var mt={name:"FavoriteMusicList",props:{list:{type:Array,default:()=>[]}},methods:{playGlobal(e,t){this.$root.player={url:e.url,song:e.name||e.song,singer:e.singer||e.ar_name,cover:e.cover||e.pic,album:e.album||e.al_name,id:e.id,playIndex:t,playList:this.list}},removeFavorite(e){let t=JSON.parse(localStorage.getItem("favoriteMusicIds")||"[]");t=t.filter(t=>t!==e),localStorage.setItem("favoriteMusicIds",JSON.stringify(t));const s=JSON.parse(localStorage.getItem("favoriteMusicCache")||"[]"),a=s.filter(t=>t.id!==e);localStorage.setItem("favoriteMusicCache",JSON.stringify(a)),this.$emit("refresh")},handleGoDetail(e){this.$router.push({path:`/music/${e}`})}}};const ft=(0,T.A)(mt,[["render",pt],["__scopeId","data-v-0dc8b6c2"]]);var gt=ft,kt={name:"FavoriteList",components:{FavoriteMusicList:gt},data(){return{favoriteSongs:[]}},async created(){await this.fetchFavorites()},methods:{async fetchFavorites(){const e=JSON.parse(localStorage.getItem("favoriteMusicIds")||"[]");if(!e.length)return void(this.favoriteSongs=[]);const t=JSON.parse(localStorage.getItem("favoriteMusicCache")||"[]"),s=new Map(t.map(e=>[e.id,e])),a=e.slice(0,50),i=a.map(e=>{const t=s.get(e);if(t){const{url:e,...s}=t;return console.log(e),s}return null}).filter(Boolean);this.favoriteSongs=[];let l=0;const r=setInterval(()=>{l<i.length?(this.favoriteSongs.push(i[l]),l++):clearInterval(r)},100),o=await Promise.all(i.map(e=>this.fetchUrlOnly(e.id)));i.forEach((e,t)=>{e.url=o[t]?.url||""});const n=e.slice(50);if(n.length){const e=await Promise.all(n.map(e=>this.fetchWithRetry(e)));this.favoriteSongs=[...this.favoriteSongs,...e.flat()]}},async fetchUrlOnly(e){try{const t=await(0,X.searchMusicByIdVkeys)(e);if(t.data&&200===t.data.code){const e=t.data.data?.[0]||t.data.data;return{url:e.url}}}catch(t){console.warn("获取url失败:",e,t)}return{}},async fetchWithRetry(e,t=8){let s=0;while(s<t){const t=await(0,X.searchMusicByIdVkeys)(e);if(t.data&&200===t.data.code)return t.data.data;if(!t.data||503!==t.data.code)break;s++,await new Promise(e=>setTimeout(e,200))}return[]}}};const Lt=(0,T.A)(kt,[["render",at],["__scopeId","data-v-753915f5"]]);var bt=Lt;const It=[{path:"/",component:Pe},{path:"/music/:id",component:et,props:!0},{path:"/favorite",component:bt}],Ct=(0,V.aE)({history:(0,V.Bt)(),routes:It});var wt=Ct,$t=s(7693);s(2241);const St=(0,a.Ef)(O);St.use(wt),St.use($t.I),St.mount("#app")},7571:function(e,t,s){s.d(t,{E:function(){return o},W:function(){return r},searchMusicByIdVkeys:function(){return l}});var a=s(4335);const i=a.A.create({baseURL:"https://api.vkeys.cn/v2/music/netease",timeout:1e4});function l(e,t=4){return i.get("",{params:{id:e,quality:t}})}function r(e){return i.get("",{params:{word:e}})}function o(e){return i.get("/lyric",{params:{id:e}})}}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var l=t[a]={exports:{}};return e[a].call(l.exports,l,l.exports,s),l.exports}s.m=e,function(){var e=[];s.O=function(t,a,i,l){if(!a){var r=1/0;for(u=0;u<e.length;u++){a=e[u][0],i=e[u][1],l=e[u][2];for(var o=!0,n=0;n<a.length;n++)(!1&l||r>=l)&&Object.keys(s.O).every(function(e){return s.O[e](a[n])})?a.splice(n--,1):(o=!1,l<r&&(r=l));if(o){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,i,l]}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var i,l,r=a[0],o=a[1],n=a[2],c=0;if(r.some(function(t){return 0!==e[t]})){for(i in o)s.o(o,i)&&(s.m[i]=o[i]);if(n)var u=n(s)}for(t&&t(a);c<r.length;c++)l=r[c],s.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return s.O(u)},a=self["webpackChunkmusic_web"]=self["webpackChunkmusic_web"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(6628)});a=s.O(a)})();
//# sourceMappingURL=app.2fc1ae41.js.map